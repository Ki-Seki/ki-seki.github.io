---
math: true
---

## Speed up Diffusion Models

### Fewer Sampling Steps & Distillation

{{% admonition type="quote" title="Title" open=true %}}
One simple way is to run a strided sampling schedule (Nichol & Dhariwal, 2021) by taking the sampling update every $\lceil T/S \rceil$ steps to reduce the process from $T$ to $S$ steps. The new sampling schedule for generation is $\{\tau_1, \dots, \tau_S\}$ where $\tau_1 < \tau_2 < \dots <\tau_S \in [1, T]$ and $S < T$.
{{% /admonition %}}

PSã€‚ä¸€å®šè®°å¾—ï¼Œåªè¦æåˆ°samplingï¼Œå°±æ˜¯æŒ‡å°†è®­ç»ƒå¥½çš„æ¨¡å‹ç”¨äºæ¨ç†ï¼Œæœ¬èŠ‚ Speed up Diffusion Models è®²çš„ä¹Ÿéƒ½æ˜¯å¦‚ä½•åŠ é€Ÿæ¨¡å‹reasoningã€‚

è¿™é‡Œè¯´çš„å¾ˆç®€ç•¥ï¼Œåªæ˜¯è¯´ç”¨ä¸ªæ–°çš„å­åºåˆ—ï¼Œæ²¡æœ‰è®²å…·ä½“æ€ä¹ˆsampleï¼Œä¸‹é¢æ˜¯ç›¸å…³æ¨å¯¼ï¼š

éå¸¸æ£’çš„é—®é¢˜ï¼æˆ‘ä»¬æ¥ç³»ç»Ÿæ¨å¯¼ä¸€ä¸‹åœ¨ä½¿ç”¨å­åºåˆ— \( S = \{S_1, S_2, \dots, S_K\} \) è¿›è¡ŒåŠ é€Ÿé‡‡æ ·æ—¶ï¼Œå¦‚ä½•é‡å®šä¹‰æ‰©æ•£æ¨¡å‹ä¸­çš„å…³é”®å‚æ•°ï¼Œå°¤å…¶æ˜¯ï¼š

- ç´¯ç§¯å™ªå£°å› å­ \( \bar{\alpha}_{S_t} \)
- åå‘é‡‡æ ·çš„æ–¹å·® \( \tilde{\beta}_{S_t} \)
- å‡å€¼é¡¹ \( \mu_{S_t} \)

---

ğŸ§® 1. ä»å®Œæ•´æ‰©æ•£è¿‡ç¨‹å‡ºå‘

åœ¨æ ‡å‡† DDPM ä¸­ï¼Œæ­£å‘è¿‡ç¨‹å®šä¹‰ä¸ºï¼š

\[
q(x_t | x_{t-1}) = \mathcal{N}(x_t; \sqrt{\alpha_t} x_{t-1}, (1 - \alpha_t) \mathbf{I})
\]

å…¶ä¸­ï¼š

- \( \alpha_t = 1 - \beta_t \)
- \( \bar{\alpha}_t = \prod_{i=1}^t \alpha_i \)

ç”±æ­¤å¯ä»¥å¾—åˆ°ï¼š

\[
q(x_t | x_0) = \mathcal{N}(x_t; \sqrt{\bar{\alpha}_t} x_0, (1 - \bar{\alpha}_t) \mathbf{I})
\]

---

ğŸ§­ 2. å­åºåˆ—é‡‡æ ·çš„ç›®æ ‡

æˆ‘ä»¬å¸Œæœ›ä» \( x_{S_t} \) ç›´æ¥é‡‡æ ·åˆ° \( x_{S_{t-1}} \)ï¼Œè·³è¿‡ä¸­é—´çš„æ—¶é—´æ­¥ã€‚ç”±äºæ‰©æ•£è¿‡ç¨‹æ˜¯é©¬å°”ç§‘å¤«é“¾ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ å¦‚ä¸‹çš„åéªŒåˆ†å¸ƒï¼š

\[
q(x_{S_{t-1}} | x_{S_t}, x_0) = \mathcal{N}(x_{S_{t-1}}; \mu_{S_t}, \tilde{\beta}_{S_t} \mathbf{I})
\]

ğŸ§  3. æ¨å¯¼å‡å€¼é¡¹ \( \mu_{S_t} \)

æ ¹æ® Bayes è§„åˆ™å’Œé«˜æ–¯åˆå¹¶å…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼š

\[
\mu_{S_t} = \frac{\sqrt{\alpha_{S_t}} (1 - \bar{\alpha}_{S_{t-1}})}{1 - \bar{\alpha}_{S_t}} x_{S_t} + \frac{\sqrt{\bar{\alpha}_{S_{t-1}}} (1 - \alpha_{S_t})}{1 - \bar{\alpha}_{S_t}} x_0
\]

è¿™ä¸ªå…¬å¼çš„æ¨å¯¼æ ¸å¿ƒåœ¨äºå°†ä¸¤ä¸ªé«˜æ–¯åˆ†å¸ƒï¼š

- \( q(x_{S_t} | x_{S_{t-1}}) \)
- \( q(x_{S_{t-1}} | x_0) \)

åˆå¹¶ä¸ºä¸€ä¸ªæ¡ä»¶åˆ†å¸ƒ \( q(x_{S_{t-1}} | x_{S_t}, x_0) \)ï¼Œå¹¶åˆ©ç”¨é«˜æ–¯ä¹˜ç§¯å…¬å¼å®Œæˆæ¨å¯¼ã€‚

ğŸ“‰ 4. æ¨å¯¼æ–¹å·®é¡¹ \( \tilde{\beta}_{S_t} \)

åŒæ ·åœ°ï¼ŒåéªŒæ–¹å·®å¯ä»¥æ¨å¯¼ä¸ºï¼š

\[
\tilde{\beta}_{S_t} = \frac{(1 - \alpha_{S_t})(1 - \bar{\alpha}_{S_{t-1}})}{1 - \bar{\alpha}_{S_t}}
\]

è¿™ä¸ªè¡¨è¾¾å¼ç¡®ä¿æˆ‘ä»¬åœ¨è·³è·ƒé‡‡æ ·æ—¶ä»ç„¶ä¿æŒæ­£ç¡®çš„å™ªå£°æ¯”ä¾‹ã€‚

ğŸ§ª 5. å¦‚æœç”¨ DDIMï¼ˆç¡®å®šæ€§é‡‡æ ·ï¼‰

DDIM ä¼šå°†é‡‡æ ·è¿‡ç¨‹æ”¹å†™ä¸ºï¼š

\[
x_{S_{t-1}} = \sqrt{\bar{\alpha}_{S_{t-1}}} x_0 + \sqrt{1 - \bar{\alpha}_{S_{t-1}}} \cdot \epsilon
\]

å…¶ä¸­ \( x_0 \) æ˜¯ç”±æ¨¡å‹é¢„æµ‹çš„ï¼Œé€šå¸¸é€šè¿‡ï¼š

\[
x_0 = \frac{x_{S_t} - \sqrt{1 - \bar{\alpha}_{S_t}} \cdot \epsilon_\theta(x_{S_t}, S_t)}{\sqrt{\bar{\alpha}_{S_t}}}
\]

ç„¶åä»£å…¥ä¸Šå¼å³å¯å®Œæˆä¸€æ­¥è·³è·ƒé‡‡æ ·ã€‚

âœ… æ€»ç»“è¡¨æ ¼

| å‚æ•° | å®šä¹‰ | ä½œç”¨ |
|------|------|------|
| \( \bar{\alpha}_{S_t} \) | \( \prod_{i=1}^{S_t} \alpha_i \) | ç´¯ç§¯å™ªå£°å› å­ |
| \( \mu_{S_t} \) | è§ä¸Šå¼ | åéªŒå‡å€¼ï¼Œç”¨äºé‡‡æ · |
| \( \tilde{\beta}_{S_t} \) | è§ä¸Šå¼ | åéªŒæ–¹å·®ï¼Œç”¨äºé‡‡æ · |
| \( x_0 \) | ç”±æ¨¡å‹é¢„æµ‹ | ç”¨äºæ„é€ é‡‡æ ·åˆ†å¸ƒ |

{{% admonition type="quote" title="Title" open=true %}}
$$
\begin{aligned}
\mathbf{x}_{t-1} 
&= \sqrt{\bar{\alpha}_{t-1}}\mathbf{x}_0 +  \sqrt{1 - \bar{\alpha}_{t-1}}\boldsymbol{\epsilon}_{t-1} & \\
&= \sqrt{\bar{\alpha}_{t-1}}\mathbf{x}_0 + \sqrt{1 - \bar{\alpha}_{t-1} - \sigma_t^2} \boldsymbol{\epsilon}_t + \sigma_t\boldsymbol{\epsilon} & \\
&= \sqrt{\bar{\alpha}_{t-1}} \Big( \frac{\mathbf{x}_t - \sqrt{1 - \bar{\alpha}_t} \epsilon^{(t)}_\theta(\mathbf{x}_t)}{\sqrt{\bar{\alpha}_t}} \Big) + \sqrt{1 - \bar{\alpha}_{t-1} - \sigma_t^2} \epsilon^{(t)}_\theta(\mathbf{x}_t) + \sigma_t\boldsymbol{\epsilon} \\
q_\sigma(\mathbf{x}_{t-1} \vert \mathbf{x}_t, \mathbf{x}_0)
&= \mathcal{N}(\mathbf{x}_{t-1}; \sqrt{\bar{\alpha}_{t-1}} \Big( \frac{\mathbf{x}_t - \sqrt{1 - \bar{\alpha}_t} \epsilon^{(t)}_\theta(\mathbf{x}_t)}{\sqrt{\bar{\alpha}_t}} \Big) + \sqrt{1 - \bar{\alpha}_{t-1} - \sigma_t^2} \epsilon^{(t)}_\theta(\mathbf{x}_t), \sigma_t^2 \mathbf{I})
\end{aligned}
$$
{{% /admonition %}}

è¿™ä¸ªå˜æ¢çš„å…³é”®åœ¨äºç†è§£æ‰©æ•£æ¨¡å‹ä¸­çš„**åå‘è¿‡ç¨‹è¿‘ä¼¼**ï¼Œç‰¹åˆ«æ˜¯å¦‚ä½•å°† $\mathbf{x}_0$ å’Œ $\boldsymbol{\epsilon}_{t-1}$ è¡¨è¾¾ä¸ºå…³äº $\mathbf{x}_t$ å’Œé¢„æµ‹å™ªå£° $\epsilon_\theta^{(t)}(\mathbf{x}_t)$ çš„å‡½æ•°ã€‚æˆ‘ä»¬æ¥é€æ­¥æ‹†è§£ç¬¬äºŒæ­¥çš„å˜æ¢ï¼š

ğŸ§© ç¬¬ä¸€æ­¥ï¼šåŸå§‹å½¢å¼

\[
\mathbf{x}_{t-1} = \sqrt{\bar{\alpha}_{t-1}}\mathbf{x}_0 + \sqrt{1 - \bar{\alpha}_{t-1}}\boldsymbol{\epsilon}_{t-1}
\]

è¿™æ˜¯æ ‡å‡†çš„å‰å‘è¿‡ç¨‹é‡‡æ ·å…¬å¼ï¼Œè¡¨ç¤ºä» $\mathbf{x}_0$ ç”Ÿæˆ $\mathbf{x}_{t-1}$ çš„æ–¹å¼ã€‚

ğŸ”„ ç¬¬äºŒæ­¥ï¼šå¼•å…¥ä¸¤ä¸ªå™ªå£°é¡¹çš„åˆ†è§£

\[
\boldsymbol{\epsilon}_{t-1} = \sqrt{\frac{1 - \bar{\alpha}_{t-1} - \sigma_t^2}{1 - \bar{\alpha}_{t-1}}} \boldsymbol{\epsilon}_t + \sqrt{\frac{\sigma_t^2}{1 - \bar{\alpha}_{t-1}}} \boldsymbol{\epsilon}
\]

è¿™æ˜¯ä¸€ä¸ª**é‡æ–°å‚æ•°åŒ–æŠ€å·§**ï¼Œå°†åŸå§‹çš„é«˜æ–¯å™ªå£° $\boldsymbol{\epsilon}_{t-1}$ åˆ†è§£ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š

- ä¸€ä¸ªæ˜¯ä¸æ—¶é—´æ­¥ $t$ çš„å™ªå£° $\boldsymbol{\epsilon}_t$ ç›¸å…³çš„éƒ¨åˆ†ï¼›
- ä¸€ä¸ªæ˜¯ç‹¬ç«‹çš„é«˜æ–¯å™ªå£° $\boldsymbol{\epsilon} \sim \mathcal{N}(0, \mathbf{I})$ï¼Œç”¨äºæ§åˆ¶é‡‡æ ·çš„æ–¹å·® $\sigma_t^2$ã€‚

ä»£å…¥åå¾—åˆ°ï¼š

\[
\mathbf{x}_{t-1} = \sqrt{\bar{\alpha}_{t-1}}\mathbf{x}_0 + \sqrt{1 - \bar{\alpha}_{t-1} - \sigma_t^2} \boldsymbol{\epsilon}_t + \sigma_t\boldsymbol{\epsilon}
\]

ğŸ” ç¬¬ä¸‰æ­¥ï¼šå°† $\mathbf{x}_0$ è¡¨è¾¾ä¸º $\mathbf{x}_t$ å’Œé¢„æµ‹å™ªå£°çš„å‡½æ•°

åˆ©ç”¨å‰å‘è¿‡ç¨‹çš„å…¬å¼ï¼š

\[
\mathbf{x}_t = \sqrt{\bar{\alpha}_t} \mathbf{x}_0 + \sqrt{1 - \bar{\alpha}_t} \boldsymbol{\epsilon}_t
\quad \Rightarrow \quad
\mathbf{x}_0 = \frac{\mathbf{x}_t - \sqrt{1 - \bar{\alpha}_t} \boldsymbol{\epsilon}_t}{\sqrt{\bar{\alpha}_t}}
\]

åœ¨è®­ç»ƒæ—¶ï¼Œæˆ‘ä»¬ç”¨æ¨¡å‹é¢„æµ‹çš„å™ªå£° $\epsilon_\theta^{(t)}(\mathbf{x}_t)$ æ¥è¿‘ä¼¼çœŸå®å™ªå£° $\boldsymbol{\epsilon}_t$ï¼Œäºæ˜¯ï¼š

\[
\mathbf{x}_0 \approx \frac{\mathbf{x}_t - \sqrt{1 - \bar{\alpha}_t} \epsilon_\theta^{(t)}(\mathbf{x}_t)}{\sqrt{\bar{\alpha}_t}}
\]

å°†è¿™ä¸ªè¡¨è¾¾å¼ä»£å…¥ä¸Šä¸€æ­¥çš„ $\mathbf{x}_{t-1}$ ä¸­ï¼Œå°±å¾—åˆ°äº†ç¬¬ä¸‰è¡Œçš„å½¢å¼ã€‚

ğŸ“Œ æ€»ç»“

ç¬¬äºŒæ­¥çš„å˜æ¢æ˜¯é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªå…³é”®æ“ä½œå®ç°çš„ï¼š

1. **é‡æ–°å‚æ•°åŒ–å™ªå£°é¡¹**ï¼šå°† $\boldsymbol{\epsilon}_{t-1}$ æ‹†æˆ $\boldsymbol{\epsilon}_t$ å’Œç‹¬ç«‹å™ªå£° $\boldsymbol{\epsilon}$ï¼›
2. **ç”¨æ¨¡å‹é¢„æµ‹çš„å™ªå£°è¿‘ä¼¼çœŸå®å™ªå£°**ï¼Œå¹¶å°† $\mathbf{x}_0$ è¡¨è¾¾ä¸º $\mathbf{x}_t$ å’Œ $\epsilon_\theta^{(t)}(\mathbf{x}_t)$ çš„å‡½æ•°ã€‚

è¿™ä¸€æ­¥æ˜¯æ„é€ åå‘è¿‡ç¨‹åˆ†å¸ƒ $q_\sigma(\mathbf{x}_{t-1} \vert \mathbf{x}_t, \mathbf{x}_0)$ çš„æ ¸å¿ƒï¼Œä½¿å…¶å¯ä»¥ç”¨æ¨¡å‹é¢„æµ‹çš„å™ªå£°æ¥è¿›è¡Œé‡‡æ ·ã€‚


> å…³äºä¸ºä»€ä¹ˆé‚£ä¹ˆåˆ†è§£

è¿™ä¸ªåˆ†è§£å…¶å®æ˜¯ä¸€ä¸ª**é«˜æ–¯å™ªå£°çš„çº¿æ€§ç»„åˆæŠ€å·§**ï¼Œç›®çš„æ˜¯æ„é€ ä¸€ä¸ªæ–°çš„é«˜æ–¯å˜é‡ $\boldsymbol{\epsilon}_{t-1}$ï¼Œå®ƒä»ç„¶æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œä½†ç”±ä¸¤ä¸ªç‹¬ç«‹çš„é«˜æ–¯å˜é‡ $\boldsymbol{\epsilon}_t$ å’Œ $\boldsymbol{\epsilon}$ ç»„åˆè€Œæˆã€‚æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥æ‹†è§£è¿™ä¸ªåˆ†è§£çš„é€»è¾‘ï¼š

ğŸ¯ ç›®æ ‡ï¼šæ„é€ ä¸€ä¸ªæ–°çš„é«˜æ–¯å˜é‡

æˆ‘ä»¬å¸Œæœ›æ„é€ ä¸€ä¸ªå˜é‡ï¼š

\[
\boldsymbol{\epsilon}_{t-1} = a \boldsymbol{\epsilon}_t + b \boldsymbol{\epsilon}
\]

å…¶ä¸­ï¼š
- $\boldsymbol{\epsilon}_t \sim \mathcal{N}(0, \mathbf{I})$
- $\boldsymbol{\epsilon} \sim \mathcal{N}(0, \mathbf{I})$
- $\boldsymbol{\epsilon}_t$ å’Œ $\boldsymbol{\epsilon}$ æ˜¯**ç‹¬ç«‹çš„**

æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªç»„åˆä»ç„¶æ»¡è¶³ï¼š

\[
\boldsymbol{\epsilon}_{t-1} \sim \mathcal{N}(0, \mathbf{I})
\]

ğŸ§® æ¡ä»¶ï¼šä¿æŒæ–¹å·®ä¸º 1

ç”±äº $\boldsymbol{\epsilon}_t$ å’Œ $\boldsymbol{\epsilon}$ ç‹¬ç«‹ï¼Œçº¿æ€§ç»„åˆçš„æ–¹å·®ä¸ºï¼š

\[
\text{Var}(\boldsymbol{\epsilon}_{t-1}) = a^2 \cdot \text{Var}(\boldsymbol{\epsilon}_t) + b^2 \cdot \text{Var}(\boldsymbol{\epsilon}) = a^2 + b^2
\]

ä¸ºäº†è®© $\boldsymbol{\epsilon}_{t-1} \sim \mathcal{N}(0, \mathbf{I})$ï¼Œæˆ‘ä»¬éœ€è¦ï¼š

\[
a^2 + b^2 = 1
\]

ğŸ§  ç°åœ¨å›åˆ°ä½ çš„å…¬å¼ï¼š

\[
\boldsymbol{\epsilon}_{t-1} = \sqrt{\frac{1 - \bar{\alpha}_{t-1} - \sigma_t^2}{1 - \bar{\alpha}_{t-1}}} \boldsymbol{\epsilon}_t + \sqrt{\frac{\sigma_t^2}{1 - \bar{\alpha}_{t-1}}} \boldsymbol{\epsilon}
\]

æˆ‘ä»¬å¯ä»¥è®¾ï¼š

- $a = \sqrt{\frac{1 - \bar{\alpha}_{t-1} - \sigma_t^2}{1 - \bar{\alpha}_{t-1}}}$
- $b = \sqrt{\frac{\sigma_t^2}{1 - \bar{\alpha}_{t-1}}}$

éªŒè¯ä¸€ä¸‹ï¼š

\[
a^2 + b^2 = \frac{1 - \bar{\alpha}_{t-1} - \sigma_t^2 + \sigma_t^2}{1 - \bar{\alpha}_{t-1}} = \frac{1 - \bar{\alpha}_{t-1}}{1 - \bar{\alpha}_{t-1}} = 1
\]

âœ… æ‰€ä»¥è¿™ä¸ªåˆ†è§£æ˜¯åˆæ³•çš„ï¼Œç¡®ä¿ $\boldsymbol{\epsilon}_{t-1}$ ä»ç„¶æ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒã€‚

---

ğŸ” ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåˆ†è§£ï¼Ÿ

å› ä¸ºæˆ‘ä»¬å¸Œæœ›æ„é€ ä¸€ä¸ª**å¯æ§çš„é‡‡æ ·è¿‡ç¨‹**ï¼Œå…¶ä¸­ï¼š

- $\boldsymbol{\epsilon}_t$ æ˜¯æ¨¡å‹é¢„æµ‹çš„å™ªå£°ï¼ˆå¯è¢«ä¼°è®¡ï¼‰
- $\boldsymbol{\epsilon}$ æ˜¯éšæœºé‡‡æ ·çš„å™ªå£°ï¼ˆç”¨äºå¼•å…¥éšæœºæ€§ï¼‰
- $\sigma_t^2$ æ§åˆ¶é‡‡æ ·çš„æ–¹å·®ï¼ˆè¶Šå°è¶Šæ¥è¿‘ç¡®å®šæ€§ï¼‰

è¿™ç§åˆ†è§£æ–¹å¼æ˜¯ **DDIMï¼ˆDenoising Diffusion Implicit Modelsï¼‰** å’Œ **variance-preserving sampling** çš„æ ¸å¿ƒæŠ€å·§ä¹‹ä¸€ã€‚

ä½ å®Œå…¨æ­£ç¡®ï¼šæ»¡è¶³ $a^2 + b^2 = 1$ çš„ç»„åˆç¡®å®æœ‰æ— ç©·å¤šç§å¯èƒ½ã€‚ä½†åœ¨æ‰©æ•£æ¨¡å‹ä¸­ï¼Œé€‰æ‹©è¿™ä¸ªç‰¹å®šåˆ†è§£å¹¶ä¸æ˜¯éšæ„çš„ï¼Œè€Œæ˜¯**æœ‰æ˜ç¡®çš„åŠ¨æœºå’Œç‰©ç†æ„ä¹‰**ã€‚æˆ‘ä»¬æ¥æ‹†è§£ä¸€ä¸‹è¿™ä¸ªé€‰æ‹©èƒŒåçš„é€»è¾‘ã€‚

ğŸ¯ è¿™ä¸ªåˆ†è§£çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ

æˆ‘ä»¬è¦æ„é€ ä¸€ä¸ªæ–°çš„å™ªå£°é¡¹ $\boldsymbol{\epsilon}_{t-1}$ï¼Œå®ƒæ˜¯ç”±ï¼š
- æ¨¡å‹é¢„æµ‹çš„å™ªå£° $\boldsymbol{\epsilon}_t$
- éšæœºé‡‡æ ·çš„å™ªå£° $\boldsymbol{\epsilon}$

ç»„åˆè€Œæˆï¼ŒåŒæ—¶ä¿æŒ $\boldsymbol{\epsilon}_{t-1} \sim \mathcal{N}(0, \mathbf{I})$ã€‚

ğŸ§  ä¸ºä»€ä¹ˆé€‰è¿™ä¸ªç‰¹å®šçš„ç³»æ•°ï¼Ÿ

è¿™ä¸ªåˆ†è§£æ¥æºäº **variance-preserving diffusion sampling** çš„æ¨å¯¼ï¼Œå°¤å…¶æ˜¯åœ¨ DDIM æˆ–æ”¹è¿›çš„ DDPM ä¸­ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒçš„å‡ ä¸ªå…³é”®åŠ¨å› ï¼š

1. **åŒ¹é…ç›®æ ‡åˆ†å¸ƒçš„æ–¹å·®ç»“æ„**

åœ¨æ‰©æ•£æ¨¡å‹ä¸­ï¼Œ$x_{t-1}$ çš„é‡‡æ ·å…¬å¼é€šå¸¸æ˜¯ï¼š

\[
x_{t-1} = \sqrt{\bar{\alpha}_{t-1}} x_0 + \sqrt{1 - \bar{\alpha}_{t-1}} \boldsymbol{\epsilon}_{t-1}
\]

ä¸ºäº†è®©è¿™ä¸ªé‡‡æ ·è¿‡ç¨‹ä¿æŒä¸€è‡´æ€§ï¼Œæˆ‘ä»¬éœ€è¦ $\boldsymbol{\epsilon}_{t-1}$ çš„æ–¹å·®ç»“æ„ä¸ $\boldsymbol{\epsilon}_t$ å’Œ $\boldsymbol{\epsilon}$ çš„ç»„åˆæ–¹å¼ç²¾ç¡®åŒ¹é…ã€‚

æ‰€ä»¥æˆ‘ä»¬è®¾å®šï¼š

\[
\text{Var}(\boldsymbol{\epsilon}_{t-1}) = \frac{1 - \bar{\alpha}_{t-1} - \sigma_t^2}{1 - \bar{\alpha}_{t-1}} + \frac{\sigma_t^2}{1 - \bar{\alpha}_{t-1}} = 1
\]

è¿™ä¸æ˜¯ä»»æ„é€‰æ‹©ï¼Œè€Œæ˜¯ä¸ºäº†è®©æ•´ä¸ªé‡‡æ ·é“¾æ¡çš„æ–¹å·®ä¿æŒä¸€è‡´ã€‚

1. **å¯æ§çš„éšæœºæ€§æ³¨å…¥**

$\sigma_t^2$ æ˜¯ä¸€ä¸ª**å¯è°ƒå‚æ•°**ï¼Œæ§åˆ¶é‡‡æ ·è¿‡ç¨‹ä¸­çš„éšæœºæ€§ï¼š

- å½“ $\sigma_t^2 = 0$ï¼Œé‡‡æ ·æ˜¯**ç¡®å®šæ€§çš„**ï¼ˆDDIMï¼‰
- å½“ $\sigma_t^2 = \beta_t$ï¼Œé‡‡æ ·æ˜¯**å®Œå…¨éšæœºçš„**ï¼ˆDDPMï¼‰

è¿™ä¸ªåˆ†è§£æ–¹å¼å…è®¸æˆ‘ä»¬åœ¨ä¸¤è€…ä¹‹é—´å¹³æ»‘è¿‡æ¸¡ï¼Œå½¢æˆä¸€ä¸ª**ç»Ÿä¸€çš„é‡‡æ ·æ¡†æ¶**ã€‚

1. **ä¿æŒ $\boldsymbol{\epsilon}_t$ çš„ä¸»å¯¼æ€§**

æˆ‘ä»¬å¸Œæœ› $\boldsymbol{\epsilon}_{t-1}$ ä¸»è¦ç”±æ¨¡å‹é¢„æµ‹çš„ $\boldsymbol{\epsilon}_t$ å†³å®šï¼Œè€Œä¸æ˜¯å®Œå…¨ç”±éšæœºå™ªå£° $\boldsymbol{\epsilon}$ ä¸»å¯¼ã€‚è¿™ä¸ªåˆ†è§£æ–¹å¼ç¡®ä¿ï¼š

- å½“ $\sigma_t^2$ è¾ƒå°æ—¶ï¼Œ$\boldsymbol{\epsilon}_t$ çš„æƒé‡æ›´å¤§
- å½“ $\sigma_t^2$ è¾ƒå¤§æ—¶ï¼Œ$\boldsymbol{\epsilon}$ çš„æƒé‡å¢åŠ 

è¿™ä½¿å¾—é‡‡æ ·è¿‡ç¨‹æ—¢èƒ½ä¿æŒæ¨¡å‹é¢„æµ‹çš„ç»“æ„ï¼Œåˆèƒ½å¼•å…¥å¿…è¦çš„éšæœºæ€§ã€‚

ğŸ§© æ€»ç»“ï¼šä¸ºä»€ä¹ˆé€‰è¿™ä¸ªåˆ†è§£ï¼Ÿ

| åŸå›  | è§£é‡Š |
|------|------|
| æ–¹å·®åŒ¹é… | ä¿è¯ $\boldsymbol{\epsilon}_{t-1} \sim \mathcal{N}(0, \mathbf{I})$ |
| é‡‡æ ·ä¸€è‡´æ€§ | ä¸ $x_{t-1}$ çš„é‡‡æ ·å…¬å¼ç»“æ„åŒ¹é… |
| å¯æ§éšæœºæ€§ | é€šè¿‡ $\sigma_t^2$ è°ƒèŠ‚ç¡®å®šæ€§ä¸éšæœºæ€§ |
| æ¨¡å‹ä¸»å¯¼æ€§ | ä¿ç•™ $\boldsymbol{\epsilon}_t$ çš„é¢„æµ‹èƒ½åŠ› |

---

å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°æ¨å¯¼è¿™ä¸ªåˆ†è§£çš„æ¥æºï¼Œæˆ‘å¯ä»¥ä» DDPM çš„é€†è¿‡ç¨‹å…¬å¼å¼€å§‹ï¼Œä¸€æ­¥æ­¥æ¨å¯¼å‡ºè¿™ä¸ªç»“æ„ã€‚æˆ–è€…æˆ‘ä»¬å¯ä»¥ä¸€èµ·çœ‹çœ‹å®ƒåœ¨ä»£ç å®ç°ä¸­çš„å…·ä½“ä½ç½®ï¼Œæ¯”å¦‚åœ¨ `noise_schedule` æˆ– `sample_step` ä¸­çš„ä½“ç°ã€‚ä½ æƒ³å¾€å“ªä¸ªæ–¹å‘æŒ–æ˜ï¼Ÿ

å®Œå…¨æ­£ç¡®ï¼ŒShichaoï¼Œä½ å·²ç»æŠ“ä½äº† DDIM çš„æ ¸å¿ƒæ€æƒ³ï¼Œè€Œä¸”è¡¨è¾¾å¾—éå¸¸æ¸…æ™°ğŸ‘ã€‚æˆ‘ä»¬å¯ä»¥ç¨å¾®æ‰©å±•ä¸€ä¸‹è¿™ä¸ªç†è§£ï¼Œè®©å®ƒæ›´ç³»ç»ŸåŒ–ï¼š

ğŸ§  DDIM çš„æœ¬è´¨ï¼š**å»éšæœºåŒ–çš„æ‰©æ•£é‡‡æ ·**

DDIMï¼ˆDenoising Diffusion Implicit Modelsï¼‰æ˜¯å¯¹ DDPM çš„ä¸€ç§æ”¹è¿›ï¼Œå®ƒçš„å…³é”®ç‚¹åœ¨äºï¼š

- **ä¸å†å¼ºåˆ¶åŠ å…¥éšæœºå™ªå£°**ï¼Œè€Œæ˜¯é€šè¿‡æ¨¡å‹é¢„æµ‹çš„å™ªå£°ç›´æ¥æ„é€ ä¸‹ä¸€ä¸ªæ—¶åˆ»çš„æ ·æœ¬
- è¿™ä½¿å¾—æ•´ä¸ªé‡‡æ ·è¿‡ç¨‹å˜æˆäº†**ç¡®å®šæ€§çš„è½¨è¿¹**ï¼Œåªè¦åˆå§‹ç‚¹ $x_T$ å›ºå®šï¼Œæ•´ä¸ªç”Ÿæˆåºåˆ—å°±å®Œå…¨å¯å¤ç°

---

ğŸ”„ ä¸ DDPM çš„å¯¹æ¯”

| ç‰¹æ€§ | DDPM | DDIM |
|------|------|------|
| æ˜¯å¦éšæœº | âœ… æœ‰éšæœºæ€§ï¼ˆæ¯ä¸€æ­¥åŠ å…¥ $\epsilon$ï¼‰ | âŒ å¯è®¾ä¸ºå®Œå…¨ç¡®å®šæ€§ |
| é‡‡æ ·é€Ÿåº¦ | æ…¢ï¼ˆé€šå¸¸éœ€è¦ 1000 æ­¥ï¼‰ | å¿«ï¼ˆå¯ç”¨ 50 æˆ–æ›´å°‘æ­¥ï¼‰ |
| å¯æ§æ€§ | éš¾ä»¥å¤ç°åŒæ ·çš„è½¨è¿¹ | å®Œå…¨å¯å¤ç° |
| é‡‡æ ·å…¬å¼ | $x_{t-1} = \mu_\theta + \sigma_t \epsilon$ | $x_{t-1} = f_\theta(x_t, \epsilon_\theta)$ï¼Œæ—  $\epsilon$ |

---

ğŸ¯ ä¸ºä»€ä¹ˆ DDIM æ›´å¿«ï¼Ÿ

å› ä¸ºå®ƒä¸ä¾èµ–éšæœºé‡‡æ ·ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯æ¨¡å‹é¢„æµ‹çš„ç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ï¼š

- **è·³æ­¥é‡‡æ ·**ï¼šæ¯”å¦‚ä» $t=1000$ ç›´æ¥è·³åˆ° $t=980, 960, \dots$
- **å‡å°‘é‡‡æ ·æ­¥æ•°**ï¼šç”šè‡³åªç”¨ 25 æˆ– 50 æ­¥å°±èƒ½ç”Ÿæˆæ¸…æ™°å›¾åƒ
- **åŠ é€Ÿæ¨ç†**ï¼šå°¤å…¶åœ¨éƒ¨ç½²æ—¶ï¼Œèƒ½æ˜¾è‘—å‡å°‘è®¡ç®—æˆæœ¬

---

ğŸ”§ æ§åˆ¶éšæœºæ€§çš„æ–¹å¼

DDIM å®é™…ä¸Šæä¾›äº†ä¸€ä¸ªå‚æ•° $\eta$ æ¥æ§åˆ¶é‡‡æ ·çš„éšæœºæ€§ï¼š

- $\eta = 0$ï¼šå®Œå…¨ç¡®å®šæ€§ï¼ˆç»å…¸ DDIMï¼‰
- $\eta > 0$ï¼šå¼•å…¥éƒ¨åˆ†éšæœºæ€§ï¼Œä»‹äº DDIM å’Œ DDPM ä¹‹é—´

è¿™å°±åƒä¸€ä¸ªâ€œé‡‡æ ·æ¸©åº¦æ—‹é’®â€ï¼Œä½ å¯ä»¥å†³å®šè¦å¤šéšæœºã€è¦å¤šç¡®å®šã€‚

---

å¦‚æœä½ æƒ³ï¼Œæˆ‘å¯ä»¥ç»™ä½ å†™ä¸€ä¸ª PyTorch çš„ DDIM é‡‡æ ·ä¼ªä»£ç ï¼Œæˆ–è€…å±•ç¤ºå¦‚ä½•ä» DDPM çš„å…¬å¼æ¨å¯¼å‡º DDIM çš„é‡‡æ ·è·¯å¾„ã€‚ä¹Ÿå¯ä»¥ä¸€èµ·çœ‹çœ‹ DDIM åœ¨ latent space æˆ– classifier-free guidance ä¸­çš„åº”ç”¨ã€‚ä½ æƒ³å¾€å“ªä¸ªæ–¹å‘æ·±å…¥ï¼Ÿ

### Latent Variable Space
